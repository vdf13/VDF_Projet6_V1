# **Pseudo Code for P6**
Nom du programme ICS (Installation Configuration Serveur)
              ou RIAC (Role Installator and Configurator)


Lancer programme avec argument ( test, auto, semi-auto)
        #  Test ne lance qu'une partie test pour vérifier que le role est fonctionnel
        #  Auto installe et configure un role de manière automatique
        #  Semi-auto installe et configure un role avec confirmation de chaque étape
        
Si **auto** alors
    # Chercher adresse_IP dans le fichier yaml du répertoire  (user fixé a admin, compte sera créé sur les MC)
    lancer *ouverture_fichier*
    Si adresse_IP trouvé dans le fichier alors:
        Se connecter a la machine en ssh (la clé sera déjà installé, donc pas de mot de passe à fournir)
    sinon: 
        Exception 
        *ecrire_fichier_log* message Adresse_IP non trouvé
    Test de réponse du serveur
        Si réponse alors:
            lancer *ouverture_fichier*
            Chercher rôle dans fichier
                Si role trouvé alors:
                    lancer *installation_role* 
                sinon:
                    exception
                    *ecrire_fichier_log* avec pas de rôle trouvé
        Sinon:
            exception
            *ecrire_fichier_log* connexion pas possible
 
Si **semi-auto** alors
    # Chercher adresse_IP dans le fichier yaml du répertoire  (user fixé a admin, compte sera créé sur les MC)
    lancer *ouverture_fichier*
    Si adresse_IP trouvé alors:
        Connecter a la machine en ssh (la clé sera déjà installé, donc pas de mot de passe à fournir)
    sinon: 
        Exception 
        *ecrire_fichier_log* message Adresse_IP non trouvé
    Test de réponse du serveur
        Si réponse alors:
            lancer *ouverture_fichier*
            Chercher rôle dans fichier
                Si role trouvé alors:
                    Visualiser le role demandé et demander la confirmation d'installation
                    Si oui 
                        lancer *installation_role* 
                    si non
                        Terminer programme 
                        *ecrire_fichier_log* avec "installation du rôle abandonnée"
                sinon:
                    exception
                    *ecrire_fichier_log* avec pas de rôle trouvé
        Sinon:
            exception
            *ecrire_fichier_log* avec connexion pas possible

Si **test** alors
    # Chercher adresse_IP dans le fichier yaml du répertoire  (user fixé a admin, compte sera créé sur les MC)
    lancer *ouverture_fichier*
    Si adresse_IP trouvé alors:
        Connecter a la machine en ssh (la clé sera déjà installé, donc pas de mot de passe à fournir)
    sinon: 
        Exception 
        *ecrire_fichier_log* message Adresse_IP non trouvé
    Test de réponse du serveur
        Si réponse alors:
            lancer *ouverture_fichier*
            Chercher rôle dans fichier
                Si role trouvé alors:
                    Visualiser le role demandé et la confirmation de test
                    Si oui 
                        lancer *test_role* 
                    si non
                        Terminer programme 
                        *ecrire_fichier_log* avec "test rôle abandonnée"
                sinon:
                    exception
                    *ecrire_fichier_log* avec pas de test rôle trouvé
        Sinon:
            exception
            *ecrire_fichier_log* avec connexion pas possible

--------------            

*OUVERTURE_FICHIER*
    ouvrir fichier yaml
    lire fichier yaml
    charger les données dans une variable (exemple : $donnee_yaml)
    fermer le fichier
    exception
        *ecrire_fichier_log* avec problème ouverture du fichier
    
*INSTALLATION_ROLE*
    # Chercher dans fichier yaml si un rôle est défini 
    lancer *ouverture_fichier*
    chercher si un role est dans le fichier ( ex: $Role_name = $role dans liste trouvé dans un fichier de référence)
    lancer installation     exemple ($commande -install $role)
    si semi-auto alors
        Visualiser et demander confirmation de l'installation
    si exception:
        *ecrire_fichier_log* avec erreur d'installation
    sinon: 
        lancer *configuration_role*
        
*CONFIGURATION_ROLE*
    # Configurer un role a partir de donées du fichier yaml
    lancer *ouverture_fichier*
    Lire le fichier chargé et trouver les datas qui correspondent au role a configurer ( fichier yaml pour data, fichier référence chemin ou valeurs par défaut)
    ecrire fichier de configuration dans le bon répertoire    ( $fichier_config_role suivant $role )
    si semi-auto alors
        Visualiser et demander confirmation de la configuration
    si exception:
        *ecrire_fichier_log* avec erreur de configuration
    sinon: 
        lancer *test_role*
    
    
*TEST_ROLE*
    lancer *ouverture_fichier*
    Lire $donnee_yaml en lien avec $role et chercher la partie $test_role associé dans le fichier référence
    lancer la commande test associé au role testé
    si exception:
        *ecrire_fichier_log* avec erreur de test
    sinon: 
        afficher message FIN d'installation


*ECRIRE_FICHIER_LOG*
    ouvrir fichier log
    récupérer message personnalisé des différentes étapes et ecrire le fichier log   (exemple: /var/log/programme_ICS )
    fermer fichier log

